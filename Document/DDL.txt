--DROP DATABASE TISTORY_BLOG;
CREATE DATABASE TISTORY_BLOG;

USE TISTORY_BLOG;

CREATE TABLE TSN_OAUTH_INFO(
	IDX INT NOT NULL AUTO_INCREMENT,
	CLIENT_ID VARCHAR(255) NOT NULL,
	CLIENT_SECRET VARCHAR(255) NOT NULL,
	REDIRECT_URL VARCHAR(255) NOT NULL,
	RESPONSE_TYPE VARCHAR(100) NOT NULL,
	STATE VARCHAR(100) NOT NULL,
	GRANT_TYPE VARCHAR(100) NOT NULL,
	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY(IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;

CREATE TABLE TSN_ACCESS_TOKEN(
	IDX INT NOT NULL AUTO_INCREMENT,
	OAUTH_IDX INT NOT NULL,
	TOKEN_KEY VARCHAR(255) NOT NULL,
	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY (IDX),
	FOREIGN KEY (OAUTH_IDX) REFERENCES TSN_OAUTH_INFO(IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;

CREATE TABLE TSN_TISTORY_USER(
	IDX INT NOT NULL AUTO_INCREMENT,
	ID VARCHAR(255) NOT NULL,
	USERID VARCHAR(255) NOT NULL,
	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY (IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;

CREATE TABLE TSN_BLOG(
	IDX INT NOT NULL AUTO_INCREMENT,
	USER_IDX INT NOT NULL,
	NAME VARCHAR(255) NOT NULL,
	URL VARCHAR(255),
	SECONDARY_URL VARCHAR(255),
	NICKNAME NVARCHAR(255),
	TITLE NVARCHAR(255),
	DESCRIPTION NVARCHAR(255),
	`DEFAULT` VARCHAR(100),
	BLOG_ICON_URL VARCHAR(255),
	FAVICON_URL VARCHAR(255),
	PROFILE_THUMBNAIL_IMAGE_URL VARCHAR(255),
	PROFILE_IMAGE_URL VARCHAR(255),
	ROLE NVARCHAR(255),
	BLOGID VARCHAR(255),
 	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY (IDX),
	FOREIGN KEY (USER_IDX) REFERENCES TSN_TISTORY_USER(IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;

CREATE TABLE TSN_BLOG_STATISTICS(
	IDX INT NOT NULL AUTO_INCREMENT,
	BLOG_IDX INT NOT NULL,
	POST INT,
	COMMENT INT,
	TRACKBACK INT,
	GUESTBOOK INT,
	INVITATION INT,
	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY (IDX),
	FOREIGN KEY (BLOG_IDX) REFERENCES TSN_BLOG(IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;

CREATE TABLE TSN_CATEGORY(
	IDX INT NOT NULL AUTO_INCREMENT,
	BLOG_IDX INT NOT NULL,
	CATEGORY_ID VARCHAR(255),
	NAME NVARCHAR(255),
	PARENT VARCHAR(255),
	LABEL NVARCHAR(255),
	ENTRIES VARCHAR(255),
	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY (IDX),
	FOREIGN KEY (BLOG_IDX) REFERENCES TSN_BLOG(IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;


CREATE TABLE TSN_POST(
	IDX INT NOT NULL AUTO_INCREMENT,
	BLOG_IDX INT NOT NULL,
	CATEGORY_IDX INT NULL,
	POST_ID VARCHAR(100) NOT NULL,
	TITLE NVARCHAR(255),
	URL	VARCHAR(255),
	POST_URL VARCHAR(255),
	SECONDARY_URL VARCHAR(255),
	CONTENTS_PATH VARCHAR(255),
	CATEGORY_ID VARCHAR(255),
	TAGS NVARCHAR(255),
	DATE DATETIME,
	CREATEDDATE DATETIME DEFAULT NOW() NOT NULL,
	ISDELETED BIT DEFAULT 0 NOT NULL,
	ISMODIFIED BIT DEFAULT 0 NOT NULL,
	
	PRIMARY KEY (IDX),
	FOREIGN KEY (BLOG_IDX) REFERENCES TSN_BLOG(IDX),
	FOREIGN KEY (CATEGORY_IDX) REFERENCES TSN_CATEGORY(IDX)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=DYNAMIC;

